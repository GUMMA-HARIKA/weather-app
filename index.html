<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
     <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> -->

    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="container">
        <div class="searchBar">
        <div class="searchBarParentDiv">
            <input type="text" class="inputfield" placeholder="Search City">
            <img src="./img/search.png" alt="" width="35px" class="searchIcon" onclick="fetchData()">
        </div>
        </div>
        <div class="context">
            <div class="leftContext">
            <div class="leftbox place">
                <h2 id="city">City Name</h2>
                <h1 ><span id="degree">0</span><SUP>&deg;</SUP>C</h1>
                <p class="desc">temp</p><hr>
                <div class="date"><img src="./img/calendar.png" width="20">
                    <p class="dates">
                    0/0/2000</p></div>
                <div class="clock"><img src="./img/time.png" width='20'><p class="times">
                   00:00:00 AM</p></div>
            </div>
            <div class="leftbox forecast">
                <h1>Coming 5 Days</h1>
                <div class="fivedays">
                    <div class="day"><img src="./img/clouds.png" width="25"><h3>temp</h3><h3>day1</h3><h3>date1</h3></div>
                    <div class="day"><img src="./img/clouds.png" width="25"><h3>temp</h3><h3>day1</h3><h3>date1</h3></div>
                    <div class="day"><img src="./img/clouds.png" width="25"><h3>temp</h3><h3>day1</h3><h3>date1</h3></div>
                    <div class="day"><img src="./img/clouds.png" width="25"><h3>temp</h3><h3>day1</h3><h3>date1</h3></div>
                    <div class="day"><img src="./img/clouds.png" width="25"><h3>temp</h3><h3>day1</h3><h3>date1</h3></div>
                
                </div>
                
            </div>
            </div>
            <div class="rightContext">
                <div class="rightDiv">
                    <div class="rightbox1 box1 box "><img src="./img/flood.png" width="50" ><div class="b1 "><h2 >Humidity</h2> <h2 class="humidity">---</h2></div></div>
                    <div class="rightbox1 box1 box "><img src="./img/humidity.png" width="50" ><div class="b1 "><h2 >Pressure</h2><h2 class="pressure">---</h2></div></div>
                    <div class="rightbox1 box1 box "><img src="./img/hot.png" width="50" ><div class="b1 "><h2 >Feels Like</h2><h2 class="feels">---</h2></div></div>
                    <div class="rightbox1 box1 box"><img src="./img/eye.png" width="50" ><div class="b1 "><h2 >Visibility</h2><h2 class="visibility">---</h2>  </div></div>
                </div>
                <div class="rightDiv">
                    <div class="rightbox1 box2 ">
                        <h2>Air Quality Index(AQI)</h2>
                        <div class="box ">
                            <img src="./img/wind.png" width="60">
                            <div class="box5">
                            <div>
                                <h2>CO</h2>
                                <h3 class="co">0</h3>
                            </div>
                            <div>
                                <h2>SO<sub>2</sub> </h2>
                                <h3 class="so">0</h3>
                            </div>
                            <div>
                                <h2>O<SUB>3</SUB></h2>
                                <h3 class="o3">0</h3>
                            </div>
                            <div>
                                <h2>NO<SUB>2</SUB> </h2>
                                <h3 class="no">0</h3>
                            </div>
                            </div>

                        </div>
                    </div>
                    <div class="rightbox1 box2">
                      <h2>Sunrise & Sunset</h2>  
                      <div class="box box5">
                      <div>
                        <div class="box4"><img src="./img/sun.png" width="60">
                        <div><h3>Sunrise</h3><h4 class="rise">00:00:00</h4></div></div>
                      </div>
                      <div>
                        <div class="box4"><img src="./img/moon.png" width="60">
                        <div><h3>Sunset</h3><h4 class="set">00:00:00</h4></div></div>
                      </div>
                      </div>
                    </div>

                </div>
                <div class="today">
                    <h2>Today</h2>
                    <div class="rightDiv" id="todayTempature">
                    <div class="rightbox1 box3"><h5>9</h5><img src="./img/cloudy.png" width="50"><h5>0 <sup>&deg;</sup>C</h5></div>
                    <div class="rightbox1 box3"><h5>9</h5><img src="./img/cloudy.png" width="50"><h5>0 <sup>&deg;</sup>C</h5></div>
                    <div class="rightbox1 box3"><h5>9</h5><img src="./img/cloudy.png" width="50"><h5>0 <sup>&deg;</sup>C</h5></div>
                    <div class="rightbox1 box3"><h5>9</h5><img src="./img/cloudy.png" width="50"><h5>0 <sup>&deg;</sup>C</h5></div>
                    <div class="rightbox1 box3"><h5>9</h5><img src="./img/cloudy.png" width="50"><h5>0 <sup>&deg;</sup>C</h5></div>
                    <div class="rightbox1 box3"><h5>9</h5><img src="./img/cloudy.png" width="50"><h5>0 <sup>&deg;</sup>C</h5></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>

     <script>
        function dateFormat(timestamp) {
            const date = new Date(timestamp * 1000); // Multiply by 1000 to convert from seconds to milliseconds
            return date.toLocaleString();// Convert to local time format and return it
        }
        async function fetchData() {
            let contextStyle=document.querySelector('.context');
            contextStyle.style.display='flex';
            let cityName=document.querySelector('.inputfield').value;
            // console.log(cityName)
            let fetchData = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${cityName}&appid=0d7a4e960d7baf914d7874eb4cc6bfe2&units=metric`)
            let formattedData = await fetchData.json();
            console.log(formattedData);
            let name=formattedData.name;
            let city=document.getElementById('city')
            console.log(city)
            city.innerText=name;
            $('#degree')[0].innerText=formattedData.main.temp;
            $('.desc')[0].innerText=formattedData.weather[0].description;
            let dateAndTime=dateFormat(formattedData.dt)
            console.log(dateAndTime)
            $('.dates')[0].innerText=dateAndTime.split(',')[0];
            $('.times')[0].innerText=dateAndTime.split(',')[1];
           let sunrise=dateFormat(formattedData.sys.sunrise)
           let sunset=dateFormat(formattedData.sys.sunset)
           $('.rise')[0].innerText=sunrise.split(',')[1]
           $('.set')[0].innerText=sunset.split(',')[1]
            $('.feels')[0].innerText=formattedData.main.feels_like;
            $('.humidity')[0].innerText=formattedData.main.humidity;
            $('.pressure')[0].innerText=formattedData.main.pressure;
            $('.visibility')[0].innerText=formattedData.visibility;
            let lon=formattedData.coord.lon;
            let lat=formattedData.coord.lat;
            fetchAQIData(lon,lat);
        }
        async function fetchAQIData(lon,lat) {
            let fetchdata=await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=0d7a4e960d7baf914d7874eb4cc6bfe2`)
            let actualData=await fetchdata.json()
            console.log('aqi',actualData);
            $('.co')[0].innerText=actualData.list[0].components.co
            $('.so')[0].innerText=actualData.list[0].components.so2
            $('.o3')[0].innerText=actualData.list[0].components.o3
            $('.no')[0].innerText=actualData.list[0].components.no2  
            tempPrediction(lon,lat)
            todayTemps(lat,lon)
        }
        async function tempPrediction(lat,lon) {
           let fetchtemp=await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=0d7a4e960d7baf914d7874eb4cc6bfe2&units=metric`) 
           let temperature=await fetchtemp.json()
           let data={}
           temperature.list.forEach(element => {
            let date=element.dt_txt.split(' ')[0];
            console.log(date)
             if (!data[date]) {
                        data[date] = {
                            temp: element.main.temp.toFixed(1), // Round temperature
                            icon: element.weather[0].icon, // Weather icon
                            day: new Date(date).toLocaleDateString('en-US', { weekday: 'long' }) 
                }
            }
           });
           let htmlcode=''
           Object.keys(data).slice(0,5).forEach(e=>{
                let dataObject=data[e];
                htmlcode+=`<div class="day"><div class='daydegree'><img src="./img/clouds.png" width="25" alt=""><p>${dataObject.temp} <sup>&deg;</sup>C
                    </p></div><p>${dataObject.day}</p><p>${e}</p></div>`
           })
        document.querySelector('.fivedays').innerHTML=htmlcode
        }
        async function todayTemps(lat, lon) {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=0d7a4e960d7baf914d7874eb4cc6bfe2&units=metric`)
                const data = await response.json();

                let todayDate = new Date().toISOString().split("T")[0]; // Get today's date (YYYY-MM-DD)
                let todayForecasts = data.list.filter(item => item.dt_txt.startsWith(todayDate)); 
                let selectedHours = todayForecasts.slice(0, 6); 
                let todayHtml = "";
                selectedHours.forEach(item => {
                    let time = new Date(item.dt_txt).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
                    let temp = item.main.temp.toFixed(1); 
                    let icon = item.weather[0].icon; 

                    todayHtml += `
                        <div class="rightbox1 box3 box7"><h5>${time}</h5><img src="./img/cloudy.png" width="50" alt="S"><h5>${temp} <sup>&deg;</sup>C</h5></div>
                    `;
                });
                console.log(todayHtml)

                document.querySelector('#todayTempature').innerHTML = todayHtml;

            // } catch (error) {
            //     console.error(error);
            //     alert("Failed to retrieve weather data. Please check your API key.");
            // }
        }

     </script>
</body>
</html>